# SymQEMU tests

The purpose of those tests is to automatically run SymQEMU on some known binaries and check that it gives the expected outputs (i.e. check that it generate the expected test cases).

The directory `binaries` contains a directory for each test binary. A test binary directory contains the following:

- An executable file `binary`
- A file `input` whose name will be given as first argument to `binary` and whose content will be symbolic
- A directory `expected_outputs` : the test cases that SymQEMU should generate when called like this : `<symqemu> <path/to/binary> <path/to/input>`, with the content of `input` being symbolic.

The script `test.py` will automatically run SymQEMU on the binaries and check that it gives the correct output.

## Adding a binary

- Create a new directory in `binaries` and put the files `binary` and `input` inside it
- Run `python3 init-new <name of your new binary directory>`. This will run SymQEMU on your new binary, create a new directory `binaries/<name of your new directory>/expected_outputs` and store the test cases generated by SymQEMU in it.
- Edit `test.py` to add your binary

## Note about the expected outputs

The expected outputs for the present tests have been generated by running the SymQEMU version from commit `f6adce9` (SymQEMU based on QEMU v 4.1.1). The idea is that we consider the behavior of this version of SymQEMU to be the "gold standard", and we check that future versions have the same behavior.

## Note about making the tests reproducible

Beware that in some situations, running the same version of SymQEMU on the same binary with the same input may give different results.

This is the case if the binary prints some symbolic data to stdout. With such a program, the simple fact of redirecting stdout to a file or not will make SymQEMU give different results, because the code that handles printing to stdout will have a different execution path. 

For this reason, it is important that the test binaries don't print symbolic data to stdout.
